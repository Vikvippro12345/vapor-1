<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles/defaults.css" />
    <style>
      body {
        margin: 0;
        height: 100vh;
        overflow: hidden;
        position: relative;
        font-family: Inter, sans-serif;
        background-color: #000;
      }

      video {
        width: 100%;
        height: 100%;
      }

      .selection {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 1000;
        background: rgba(70, 102, 156, 0.7);
        border-radius: 10px;
        height: 35px;
        user-select: none;
        color: #fff;
        border: 2px solid rgba(255, 255, 255, 0.25);
        display: flex;
        width: 75px;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: 0.15s;
      }

      .selection:hover {
        opacity: 0.85;
      }

      .options {
        position: fixed;
        top: 54px;
        left: 10px;
        display: none;
        background: rgba(28, 28, 28, 0.9);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        z-index: 999;
        width: 85px;
        opacity: 0;
        transform: translateY(-5px);
        transition: 0.15s;
      }

      .options.show {
        display: block;
        opacity: 1;
        transform: translateY(0);
      }

      .option {
        padding: 10px;
        color: rgba(255, 255, 255, 0.85);
        border-radius: 10px;
        cursor: pointer;
        transition: 0.15s;
      }

      .option:hover {
        background: rgba(70, 102, 156, 0.2);
      }

      i {
        margin-right: 5px;
      }
    </style>
  </head>

  <body>
    <div class="selection" id="selection">
      <i class="fa-solid fa-cloud"></i> 1
    </div>
    <div class="options" id="options"></div>

    <video id="videoPlayer" controls autoplay muted playsinline></video>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
      const hash = window.location.hash.slice(1),
        selection = document.getElementById("selection"),
        optionsContainer = document.getElementById("options"),
        videoPlayer = document.getElementById("videoPlayer");

      let servers = [];
      try {
        // Ensure the hash is not empty and decode the base64
        if (hash) {
          servers = atob(hash).split("$").filter((e) => e.trim() !== "");
        } else {
          alert("Hash is missing from URL.");
        }
      } catch (e) {
        alert(`Error decoding hash: ${e}`);
      }

      function playVideo(url) {
        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(url);
          hls.attachMedia(videoPlayer);
        } else if (videoPlayer.canPlayType("application/vnd.apple.mpegurl")) {
          videoPlayer.src = url;
        } else {
          console.error("HLS not supported in this browser");
        }
        videoPlayer.play().catch((err) => {
          console.error("Error attempting to play:", err);
        });
      }

      servers.forEach((e, i) => {
        const option = document.createElement("div");
        option.className = "option";
        option.innerHTML = `<i class="fa-solid fa-cloud"></i> ${i + 1}`;
        option.dataset.value = e;
        option.addEventListener("click", function () {
          playVideo(this.dataset.value);
          selection.innerHTML =
            '<i class="fa-solid fa-cloud"></i> ' + this.textContent;
          optionsContainer.classList.remove("show");
          optionsContainer.style.display = "none";
        });
        optionsContainer.appendChild(option);
      });

      selection.addEventListener("click", function () {
        if (optionsContainer.classList.contains("show")) {
          optionsContainer.classList.remove("show");
          selection.classList.remove("hover");
          setTimeout(() => (optionsContainer.style.display = "none"), 150);
        } else {
          optionsContainer.style.display = "block";
          selection.classList.add("hover");
          setTimeout(() => optionsContainer.classList.add("show"), 10);
        }
      });

      document.addEventListener("click", function (e) {
        if (
          !selection.contains(e.target) &&
          !optionsContainer.contains(e.target)
        ) {
          optionsContainer.classList.remove("show");
          optionsContainer.style.display = "none";
        }
      });

      if (servers.length > 0) {
        playVideo(servers[0]);
        selection.innerHTML = '<i class="fa-solid fa-cloud"></i> 1';
      }
    </script>
  </body>
</html>
