<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF--8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles/defaults.css" />
    <script src="/scripts/theme.js"></script>
    
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: "Inter", Arial, sans-serif;
        background: transparent;
        color: var(--text-color);
      }
      #particles-js {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -99;
      }

      .dashboard-container {
        width: 50%;
        height: 100%;
        margin: 0 auto;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--primary) var(--secondary-bg);
      }

      .sections-wrapper {
        padding: 40px 20px;
      }

      .section-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }

      .card {
        background-color: var(--secondary-bg);
        border-radius: 12px;
        padding: 20px;
        flex: 1;
        min-height: 150px;
      }

      .card-label {
        margin: 0;
        text-transform: uppercase;
        font-size: 13px;
        font-weight: 600;
        color: var(--secondary-text-color);
        letter-spacing: 0.5px;
      }

      .online-users-card .count {
        font-family: "SF Mono", "Consolas", "Roboto Mono", monospace;
        font-size: 64px;
        font-weight: 700;
        color: var(--primary);
        margin: 10px 0 0 0;
        line-height: 1;
      }
      
      .top-games-list {
        margin-top: 15px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .game-button {
        display: flex;
        align-items: center;
        gap: 12px;
        width: 100%;
        padding: 10px 12px;
        border: none;
        border-radius: 8px;
        background-color: var(--button-bg);
        color: var(--text-color);
        font-family: "Inter", sans-serif;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        text-align: left;
        transition: background-color 0.2s ease, transform 0.2s ease;
      }

      .game-button:hover {
        background-color: var(--button-hover);
        transform: scale(1.02);
      }

      .game-button .fa-star {
        color: var(--primary);
      }
    </style>
  </head>
  <body>
    <div id="particles-js"></div>

    <div class="dashboard-container">
      <div class="sections-wrapper">

        <div class="section-row">
          <div class="card online-users-card">
            <p class="card-label">Online Users</p>
            <p class="count" id="online-users-count">...</p>
          </div>
          <div class="card top-games-card">
            <p class="card-label">Top Games</p>
            <div class="top-games-list" id="top-games-list">
            </div>
          </div>
        </div>


      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="/scripts/particle.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        
        const userCountElement = document.getElementById("online-users-count");

        if (window.parent && window.parent.vaporsock) {
          userCountElement.textContent = window.parent.vaporsock.onlineusers;

          window.parent.addEventListener('vaporsock:update', (event) => {
            userCountElement.textContent = event.detail.onlineUsers;
          });
        } else {
          userCountElement.textContent = "N/A";
          console.warn("Could not connect to parent vaporsock object.");
        }


        const htmlURL = "https://cdn.jsdelivr.net/gh/gn-math/html@main";
        const topGamesList = document.getElementById("top-games-list");

        async function fetchAndDisplayTopGames() {
          try {
            const response = await fetch('/_a/zones.json');
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const allGames = await response.json();
            
            const featuredGames = allGames.filter(game => game.featured === true);
            
            topGamesList.innerHTML = '';

            featuredGames.forEach(game => {
              const button = document.createElement('button');
              button.className = 'game-button';
              button.innerHTML = `
                <i class="fa-solid fa-star"></i>
                <span>${game.name}</span>
              `;
              
              button.onclick = () => {
                const parentFrame = window.parent.document.getElementById('frame');
                if (!parentFrame) {
                  console.error("Parent frame with ID 'frame' not found!");
                  return;
                }
                
                let targetFrameUrl = game.direct
                  ? `/page/gameframe.html?url=${encodeURIComponent(game.url)}&name=${encodeURIComponent(game.name)}&direct=true`
                  : `/page/gameframe.html?url=${encodeURIComponent(game.url.replace("{HTML_URL}", htmlURL))}&name=${encodeURIComponent(game.name)}`;
                
                parentFrame.src = targetFrameUrl;
              };

              topGamesList.appendChild(button);
            });

          } catch (error) {
            console.error("Failed to fetch top games:", error);
            topGamesList.innerHTML = `<p style="opacity: 0.7;">Could not load games.</p>`;
          }
        }
        
        fetchAndDisplayTopGames();
      });
    </script>
  </body>
</html>