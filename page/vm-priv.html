<!DOCTYPE html>
 <!---------------------!
 !  Skidding this gives you no gain
 !  bye bye go away
 !---------------------->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles/defaults.css" />
    <style>
      .title,
      button {
        color: rgba(255, 255, 255, 0.95);
      }
      * {
        box-sizing: border-box;
        font-family: Inter;
      }
      body,
      html {
        height: 100%;
        overflow: hidden;
      }
      body {
        font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #0a111d;
        color: rgba(255, 255, 255, 0.9);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        align-items: center;
        justify-content: center;
      }
      .content-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        max-width: 1200px;
        padding: 16px;
        gap: 25px;
      }
      .left-container,
      .right-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: rgba(255, 255, 255, 0.06);
        width: 35%;
        height: 500px;
        border-radius: 12px;
        padding: 24px;
        text-align: left;
      }
      .button-container,
      .footer,
      .session-status,
      .status {
        text-align: center;
      }
      .title {
        font-size: 30px;
        margin-bottom: 10px;
        font-weight: 700;
      }
      .body-text {
        font-size: 16px;
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 20px;
      }
      .session-status {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 20px;
        color: rgba(255, 255, 255, 0.9);
      }
      .button-container {
        margin-top: 20px;
      }
      button {
        padding: 12px 24px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        background-color: #4c75f2;
        border: none;
        border-radius: 10px;
        transition: 0.3s;
      }
      button:hover {
        background-color: #3a5bc0;
      }
      button:disabled {
        background-color: rgba(255, 255, 255, 0.2);
        cursor: not-allowed;
        color: rgba(255, 255, 255, 0.5);
      }
      #createSession {
        padding: 16px 32px;
        font-size: 18px;
        font-weight: 600;
        background-color: rgba(255, 255, 255, 0.06);
      }
      #createSession:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      .iframe-container {
        width: 100%;
        height: calc(100vh - 100px);
        position: relative;
        background-color: none;
        border-radius: 10px;
        overflow: hidden;
        display: none;
        z-index: 1;
      }
      .footer,
      .status,
      .timer-controls,
      iframe {
        position: absolute;
      }
      .end-session-btn,
      .timer {
        color: rgba(255, 255, 255, 0.8);
        background-color: rgba(0, 0, 0, 0.4);
        padding: 8px 14px;
      }
      iframe {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }
      .timer-controls {
        top: 12px;
        width: calc(100% - 24px);
        display: flex;
        justify-content: space-between;
        z-index: 10;
      }
      .end-session-btn,
      .status,
      .timer {
        backdrop-filter: blur(4px);
        border-radius: 10px;
        display: none;
        font-size: 14px;
      }
      .end-session-btn {
        cursor: pointer;
        transition: 0.2s;
      }
      .end-session-btn:hover {
        background-color: rgba(255, 107, 107, 0.2);
      }
      .countdown {
        font-weight: 700;
        color: #4c75f2;
      }
      .status {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 12px 16px;
        color: rgba(255, 255, 255, 0.9);
        background-color: rgba(255, 255, 255, 0.08);
        max-width: 320px;
        z-index: 100;
      }
      .footer {
        margin-top: 16px;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.5);
        bottom: 8px;
      }
      .loading-icon {
        animation: 1s linear infinite spin;
        margin-right: 4px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <div class="content-container" id="introContainer">
      <div class="left-container">
        <div class="title">VAPOR Private VMs</div>
        <div class="body-text">
          Tired of the chaos in the Public VM? Try VAPOR's new Private VM
          option! Each session lasts 8 minutes, with unlimited session creations available. Perfect for quick tasks on your school device.<br /><br />
          Occasionally, all sessions may be in use. This is rare, but if it
          happens often, we'll increase capacity to meet demand.<br /><br />Private VMs are still in beta. Report bugs in the discord!!<br><br>
          Note: Private VMs are not fully private. Please avoid entering
          sensitive information such as bank details or crypto wallets (you know
          who you are).
        </div>
      </div>

      <div class="right-container">
        <div class="button-container">
          <button id="createSession">
            <i class="fas fa-desktop"></i> Create a Session
          </button>
        </div>
      </div>
    </div>

    <div id="status" class="status"></div>
    <div id="iframeContainer" class="iframe-container">
      <iframe id="hyperFrame" allowfullscreen="true"></iframe>
    </div>
    <div class="timer-controls">
      <button id="endSessionBtn" class="end-session-btn">
        <i class="fas fa-stop-circle"></i> End Session
      </button>
      <div id="timer" class="timer">
        <i class="fas fa-clock"></i> Time left:
        <span id="countdown" class="countdown">30</span>s
      </div>
    </div>

    <script>
      const createSessionBtn = document.getElementById("createSession"),
        iframeContainer = document.getElementById("iframeContainer"),
        hyperFrame = document.getElementById("hyperFrame"),
        timer = document.getElementById("timer"),
        countdown = document.getElementById("countdown"),
        status = document.getElementById("status"),
        endSessionBtn = document.getElementById("endSessionBtn"),
        API_URL = "https://prv-vms-vapor.technonyte0.workers.dev";
      let countdownInterval,
        currentSessionId = null;
      function updateCountdownDisplay(e) {
        const n = Math.floor(e / 60),
          s = e % 60;
        countdown.textContent = `${n}:${s.toString().padStart(2, "0")}`;
      }
      async function endSession() {
        if (currentSessionId) {
          try {
            (status.innerHTML =
              '<i class="fas fa-spinner loading-icon"></i> Ending session...'),
              (status.style.display = "block"),
              await fetch(`${API_URL}/terminate-session`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ sessionId: currentSessionId }),
              }),
              (status.innerHTML =
                '<i class="fas fa-check-circle"></i> Session ended'),
              setTimeout(() => {
                status.style.display = "none";
              }, 2e3),
              (document.getElementById("introContainer").style.display =
                "flex");
          } catch (e) {
            console.error("Error terminating session:", e),
              (status.innerHTML =
                '<i class="fas fa-times-circle"></i> Error ending session'),
              (status.style.display = "block"),
              setTimeout(() => {
                status.style.display = "none";
              }, 2e3);
          }
          currentSessionId = null;
        }
        (hyperFrame.src = ""),
          (iframeContainer.style.display = "none"),
          (timer.style.display = "none"),
          (endSessionBtn.style.display = "none"),
          (createSessionBtn.style.display = "block"),
          (createSessionBtn.disabled = !1),
          (createSessionBtn.innerHTML =
            '<i class="fas fa-desktop"></i> Create a Session'),
          (countdown.style.color = "#4C75F2"),
          countdownInterval && clearInterval(countdownInterval);
      }
      window.addEventListener("beforeunload", (e) => {
        currentSessionId &&
          navigator.sendBeacon(
            `${API_URL}/terminate-session`,
            JSON.stringify({ sessionId: currentSessionId })
          );
      }),
        window.addEventListener("unload", (e) => {
          currentSessionId &&
            (navigator.sendBeacon(
              `${API_URL}/terminate-session`,
              JSON.stringify({ sessionId: currentSessionId })
            ),
            (currentSessionId = null));
        }),
        endSessionBtn.addEventListener("click", () => {
          endSession();
        }),
        createSessionBtn.addEventListener("click", async () => {
          (createSessionBtn.disabled = !0),
            (createSessionBtn.innerHTML =
              '<i class="fas fa-circle-notch loading-icon"></i> Creating session...'),
            (status.style.display = "none"),
            (document.getElementById("introContainer").style.display = "none");
          try {
            const e = await fetch(`${API_URL}/create-session`),
              n = await e.json();
            if (n.error)
              return (
                (status.innerHTML =
                  '<i class="fas fa-exclamation-circle"></i> ' + n.error),
                (status.style.display = "block"),
                (createSessionBtn.disabled = !1),
                (createSessionBtn.innerHTML =
                  '<i class="fas fa-redo"></i> Try Again'),
                (document.getElementById("introContainer").style.display =
                  "flex"),
                void setTimeout(() => {
                  status.style.display = "none";
                }, 5e3)
              );
            currentSessionId = n.session_id;
            const s = n.embed_url;
            (hyperFrame.src = s),
              (iframeContainer.style.display = "block"),
              (createSessionBtn.style.display = "none");
            let t = 480;
            updateCountdownDisplay(t),
              (timer.style.display = "block"),
              (endSessionBtn.style.display = "block"),
              (status.innerHTML =
                '<i class="fas fa-spinner loading-icon"></i> Loading browser...'),
              (status.style.display = "block"),
              (hyperFrame.onload = () => {
                status.style.display = "none";
              }),
              (countdownInterval = setInterval(() => {
                t--,
                  updateCountdownDisplay(t),
                  t <= 60 && (countdown.style.color = "#ff6b6b"),
                  t <= 0 && (clearInterval(countdownInterval), endSession());
              }, 1e3));
          } catch (e) {
            console.error("Error creating session:", e),
              (status.innerHTML =
                '<i class="fas fa-exclamation-triangle"></i> No sessions available'),
              (status.style.display = "block"),
              (createSessionBtn.disabled = !1),
              (createSessionBtn.innerHTML =
                '<i class="fas fa-desktop"></i> Create a Session'),
              (document.getElementById("introContainer").style.display =
                "flex"),
              setTimeout(() => {
                status.style.display = "none";
              }, 5e3);
          }
        });
    </script>
  </body>
</html>
